<script>
function downloadPDF(){
  const d = new Date();
  const dateStr = new Intl.DateTimeFormat("de-DE",{
    year:"numeric",month:"2-digit",day:"2-digit",
    hour:"2-digit",minute:"2-digit"
  }).format(d);

  /* Werte aus dem Rechner */
  const mk = parseFloat(materialKosten.textContent);
  const sk = parseFloat(stromKosten.textContent);
  const vk = parseFloat(verschleissKosten.textContent);
  const ges = parseFloat(gesamtKosten.textContent);

  /* Balken-Logik identisch zur Anzeige */
  let barInfo = "";

  const diffPct = Math.abs(mk - sk) / Math.max(mk, sk) * 100;
  if (diffPct >= 30) {
    const sign = mk > sk ? "+" : "−";
    barInfo += `
    <tr>
      <td>Kostenunterschied Material ↔ Strom</td>
      <td>${sign}${diffPct.toFixed(1)} %</td>
    </tr>`;
  }

  const mg = (mk / ges) * 100;
  if (mg >= 30) {
    barInfo += `
    <tr>
      <td>Materialanteil an Gesamtkosten</td>
      <td>${mg.toFixed(1)} %</td>
    </tr>`;
  }

  const html = `
<!DOCTYPE html>
<html>
<head>
<style>
@page{
  size:A4 portrait;
  margin-top:10mm;
  margin-right:20mm;
  margin-bottom:20mm;
  margin-left:20mm;
}
body{font-family:Arial;font-size:12px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
td{padding:6px;border-bottom:1px solid #ccc;}
small{color:#666;}
</style>
</head>
<body>

<h2>3D-Druck Kostenübersicht</h2>
<small>
Diese Zusammenstellung dient ausschließlich der überschlägigen Darstellung
technischer Unterhaltskosten eines 3D-Drucks und stellt keine Preis-, Gewinn-
oder Angebotskalkulation dar.
</small>

<table>
<tr><td>Materialkosten</td><td>${mk.toFixed(2)} €</td></tr>
<tr><td>Stromkosten</td><td>${sk.toFixed(2)} €</td></tr>
<tr><td>Verschleißkosten</td><td>${vk.toFixed(2)} €</td></tr>
<tr><td><strong>Gesamtkosten</strong></td><td><strong>${ges.toFixed(2)} €</strong></td></tr>
</table>

${barInfo ? `
<h3>Detailkennzahlen</h3>
<table>
${barInfo}
</table>
` : ``}

<small>Erstellt am ${dateStr}</small>

</body>
</html>`;

  const w = window.open("");
  w.document.write(html);
  w.document.close();
  w.onload = () => w.print();
}
</script>
