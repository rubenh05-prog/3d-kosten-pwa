<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<title>3D-Druck Kosten Rechner</title>

<link rel="manifest" href="manifest.json">
<meta name="color-scheme" content="light dark">
<meta name="theme-color" content="#ffcc00" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="3D Kosten">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="icon" href="icon-192.png" sizes="192x192">

<style>
:root {
    --bg: #f4f4f4;
    --card: #ffffff;
    --text: #000;
    --border: #000;
    --accent: #ffcc00;
    --muted: #666;
}

@media (prefers-color-scheme: dark) {
    :root {
        --bg: #121212;
        --card: #1e1e1e;
        --text: #f1f1f1;
        --border: #333;
        --muted: #aaa;
    }
}

html { background: var(--bg); }

body {
    font-family: Arial, sans-serif;
    background: var(--bg);
    color: var(--text);

    display: flex;
    justify-content: center;
    align-items: flex-start;

    min-height: 100vh;
    margin: 0;
    padding:
        calc(16px + env(safe-area-inset-top))
        calc(16px + env(safe-area-inset-right))
        calc(16px + env(safe-area-inset-bottom))
        calc(16px + env(safe-area-inset-left));
}

.container {
    width: 100%;
    max-width: 360px;
    display: flex;
    flex-direction: column;
    gap: 14px;
}

/* Eingaben */
.top-section {
    background: var(--card);
    padding: 18px;
    border-radius: 12px;
    border-top: 6px solid var(--accent);
}

ul { list-style: none; padding: 0; margin: 0; }

li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
}

label {
    font-weight: 600;
    min-width: 145px;
}

input {
    width: 110px;
    padding: 10px 8px;
    font-size: 16px;
    border-radius: 8px;
    background: var(--card);
    color: var(--text);
    border: 1px solid var(--border);
}

.time-inputs {
    display: flex;
    gap: 6px;
}

.time-inputs input {
    width: 52px;
    text-align: center;
}

/* Ergebnisse */
.bottom-section {
    position: sticky;
    bottom: calc(12px + env(safe-area-inset-bottom));

    background: var(--card);
    border-radius: 12px;
    border-top: 2px solid var(--border);
    min-height: 130px;

    opacity: 0;
    transition: opacity 0.3s ease;
}

.bottom-section.visible { opacity: 1; }

.results-content {
    padding: 14px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
}

.results-content div {
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.25s ease;
}

.results-content div.visible {
    opacity: 1;
    transform: translateY(0);
}

.results-footer {
    font-size: 1.4em;
    font-weight: bold;
    color: var(--accent);
    text-align: center;
    padding-bottom: 12px;
}

/* Einklappbarer Info-Text */
details.info {
    background: var(--card);
    border-radius: 10px;
    padding: 10px 12px;
    font-size: 0.85em;
    color: var(--muted);
}

details.info summary {
    cursor: pointer;
    font-weight: 600;
    color: var(--text);
    list-style: none;
}

details.info summary::-webkit-details-marker {
    display: none;
}

details.info summary::after {
    content: "▾";
    float: right;
    transition: transform 0.2s ease;
}

details.info[open] summary::after {
    transform: rotate(180deg);
}

details.info p {
    margin: 8px 0 0;
    line-height: 1.45;
}
</style>
</head>

<body>

<div class="container">

<div class="top-section">
<ul>
    <li><label>Filament €/kg</label><input id="plaPreis" type="number" step="0.25" value="22.5"></li>
    <li><label>Leistung (W)</label><input id="leistung" type="number" step="10" value="130"></li>
    <li><label>Strom €/kWh</label><input id="strompreis" type="number" step="0.01" value="0.33"></li>
    <li><label>Verschleiß €/h</label><input id="verschleiss" type="number" step="0.01" value="0.08"></li>
    <li>
        <label>Druckzeit</label>
        <div class="time-inputs">
            <input id="druckzeitStunden" type="number" placeholder="h">
            <input id="druckzeitMinuten" type="number" placeholder="min">
        </div>
    </li>
    <li><label>Material (g)</label><input id="material" type="number" step="5"></li>
</ul>
</div>

<div class="bottom-section" id="results">
    <div class="results-content">
        <div>Material: <span id="materialKosten">0.00</span> €</div>
        <div>Strom: <span id="stromKosten">0.00</span> €</div>
        <div>Verschleiß: <span id="verschleissKosten">0.00</span> €</div>
    </div>
    <div class="results-footer">
        Gesamt: <span id="gesamtKosten">0.00</span> €
    </div>
</div>

<details class="info" id="infoBox">
<summary>Berechnungsgrundlage</summary>
<p>
Die Gesamtkosten setzen sich aus Material-, Strom- und Verschleißkosten zusammen.
Die Materialkosten basieren auf dem verwendeten Filamentgewicht und dem Preis pro Kilogramm.
Die Stromkosten ergeben sich aus der Leistungsaufnahme des Druckers, der Druckzeit und dem Strompreis.
Verschleißkosten werden zeitanteilig auf Basis der Druckdauer berücksichtigt.
<br><br>
Die Berechnung dient ausschließlich zur überschlägigen Ermittlung der laufenden Unterhaltskosten eines 3D-Drucks
und stellt keine Preis-, Gewinn- oder Angebotskalkulation dar.
<br><br>
Die voreingestellten Werte sind geprüfte, praxisnahe Richtwerte und liegen bewusst leicht über dem Durchschnitt,
um eine konservative Kostenschätzung zu ermöglichen.
Für eine höhere Genauigkeit sollten die Werte an das jeweils verwendete System angepasst werden.
</p>
</details>

</div>

<script>
/* Erklärungstext nur beim ersten Öffnen anzeigen */
const infoBox = document.getElementById("infoBox");
const INFO_KEY = "info_seen_v1";

if (!localStorage.getItem(INFO_KEY)) {
    infoBox.open = true;
    localStorage.setItem(INFO_KEY, "true");
}

/* Rechner-Logik (unverändert) */
const ROUND_TO = 0.1;
const inputs = document.querySelectorAll("input");
const resultsDiv = document.getElementById("results");
const rows = document.querySelectorAll(".results-content div");

inputs.forEach(i => i.addEventListener("input", handleInput));

function handleInput(e){
    sanitizeTime(e.target);
    calculate();
}

function sanitizeTime(input){
    let h = parseInt(druckzeitStunden.value) || 0;
    let m = parseInt(druckzeitMinuten.value) || 0;

    if(input.id==="druckzeitMinuten"){
        while(m>=60){m-=60;h++;}
        while(m<0){m+=60;h--;}
    }

    h = Math.min(48, Math.max(0,h));
    m = Math.min(59, Math.max(0,m));

    druckzeitStunden.value = h;
    druckzeitMinuten.value = m;
}

function get(id){return parseFloat(document.getElementById(id).value)||0;}

function calculate(){
    const zeit = (druckzeitStunden.value*60)+(druckzeitMinuten.value*1);
    const pla=get("plaPreis"), watt=get("leistung"), strom=get("strompreis"),
          versch=get("verschleiss"), mat=get("material");

    if(pla<=0||watt<=0||strom<=0||versch<=0||mat<=0||zeit<=5){
        resultsDiv.classList.remove("visible");
        rows.forEach(r=>r.classList.remove("visible"));
        return;
    }

    const h=zeit/60;
    const mk=(mat/1000)*pla;
    const sk=(watt/1000)*h*strom;
    const vk=h*versch;
    const ges=Math.ceil((mk+sk+vk)/ROUND_TO)*ROUND_TO;

    materialKosten.textContent=mk.toFixed(2);
    stromKosten.textContent=sk.toFixed(2);
    verschleissKosten.textContent=vk.toFixed(2);
    gesamtKosten.textContent=ges.toFixed(2);

    resultsDiv.classList.add("visible");
    rows.forEach((r,i)=>setTimeout(()=>r.classList.add("visible"),i*80));
}

if("serviceWorker" in navigator){
    navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
